<?php

declare(strict_types=1);
use Drupal\Core\Form\FormStateInterface;
use Drupal\Core\Url;
use Drupal\config_pages\Entity\ConfigPages;

/**
 * @file
 * Primary module hooks for sharjah_dd module.
 */



/**
 * Implements hook_theme().
 */
function sharjah_dd_theme($existing, $type, $theme, $path)
{

  return [
    'header' => [
      'variables' => ['items' => NULL],
      'template' => 'header',
    ],
    // home_banner
    'home_banner' => [
      'variables' => ['items' => NULL],
      'template' => 'home-banner',
    ],
  // performance_highlights
    'performance_highlights' => [
      'variables' => ['items' => NULL],
      'template' => 'performance-highlights',
    ],
    // front-services.html.twig
    'front_services' => [
      'variables' => ['items' => NULL],
      'template' => 'front-services',
    ],
    // front_initiatives
    'front_initiatives' => [
      'variables' => ['items' => NULL],
      'template' => 'front-initiatives',
    ],
    // front_latest_news
    'front_latest_news' => [
      'variables' => ['items' => NULL],
      'template' => 'front-latest-news',
    ],
      // footer
    'footer' => [
      'variables' => ['items' => NULL],
      'template' => 'footer',
    ],
    // about
    'about' => [
      'variables' => ['items' => NULL],
      'template' => 'about',
    ],
    'header_title_block' => [
      'variables' => [
        'items' => [],
      ],
    ],
    // looking_digital_service  
    'looking_digital_service' => [
      'variables' => ['items' => NULL],
      'template' => 'looking-digital-service',
    ],
    
  ];
}   


/**
 * Implements hook_form_alter().
 *
 * This function alters the exposed filter forms for the services view.
 */
function sharjah_dd_form_alter(&$form, FormStateInterface $form_state, $form_id)
{

  // if ($form['#id'] === 'views-exposed-form-services-main-page') {
  //   $url = Url::fromRoute('view.services.main_page', [], [
  //     'fragment' => 'services',
  //     // 'query' => \Drupal::request()->query->all(), // keep current query if needed
  //   ]);
  //   $form['#action'] = $url->toString();
  
  //   if (isset($form['keys'])) {
  //     $form['keys']['#name'] = 'title'; // rename GET param
  //   }
  // }

  // if ($form['#id'] === 'views-exposed-form-services-list') {
  //   $url = Url::fromRoute('sharjah_dd.front', [], [
  //     'fragment' => 'services',
  //     // 'query' => \Drupal::request()->query->all(), // keep current query if needed
  //   ]);
  //   $form['#action'] = $url->toString();
  
  //   if (isset($form['keys'])) {
  //     $form['keys']['#name'] = 'title'; // rename GET param
  //   }
  // }
  
}

/**
 * Implements hook_preprocess_HOOK() for webform submission form.
 */
function sharjah_dd_preprocess_webform_submission_form(array &$variables) {
  

  $config_page = ConfigPages::config('general_pages');
  if (!$config_page) {
    return [];
  }
  
  $phone = $config_page->get('field_c_phone_number')->value ?? '';
  $email = $config_page->get('field_c_email_us')->value ?? '';
  $working_hours = $config_page->get('field_c_working_hours')->getValue();
  $working_hours1 = $working_hours[0]['value'] ?? '';
  $working_hours2 = $working_hours[1]['value'] ?? '';

  $addresses = $config_page->get('field_c_address')->getValue();
  $address1 = $addresses[0]['value'] ?? '';
  $address2 = $addresses[1]['value'] ?? '';

  $form_image = $config_page->get('field_contact_image')->entity ?? '';

  $form_img_url = '';
  if ($form_image instanceof \Drupal\file\FileInterface) {
    $form_img_url = \Drupal::service('file_url_generator')->generateAbsoluteString($form_image->getFileUri());
  }
  
  // dd($working_hours2);
  // pass in array 
  $variables['contact_info'] = [
    'working_hours' => [
      'working_field1' => $working_hours1,
      'working_field2' => $working_hours2,
    ],
    'addresses' => [$address1 , $address2],
    'phone' => $phone,
    'email' => $email,
    'form_image' => $form_img_url,
  ];
  
}
